/*
* Thesaurus
*
* @package thesaurus
* @author $Author: sheiko $, modified by Richard Vencu
* @version $Id: jquery.thesaurus.js, v 3.1 $ / last modified February 06, 2014
* @license GNU
* @copyright (c) Dmitry Sheiko http://www.cmsdevelopment.com
*/
!function(t){var e="[\\s!;?â€¦.,%\"'\\(\\)\\{\\}]",o=["SCRIPT","BASE","LINK","META","STYLE","TITLE","APPLET","OBJECT","H1","H2","H3","H4","H5"],n=function(){};n.prototype={_data:[],length:function(){return this._data.length},append:function(t,e){this._data[t]=e},findById:function(t){return void 0===this._data[t]?null:this._data[t]},remove:function(t){void 0!==this._data[t]&&delete this._data[t]}};var s=function(e){t.extend(this.options,e),this.init(),this.renderUI(),this.bindUI()};s.collection=new n,s.ids=[],s.hide=function(t){var e=s.collection.findById(t.currentTarget.id);null!==e&&e.delayedDestruction()},s.remove=function(t){s.collection.remove(t)},s.normalize=function(t){t.id||(s.ids.push(t.id),t.id="dfn"+s.ids.length)},s.text=function(t,e){if(void 0!==t.currentTarget.id){var o=s.collection.findById(t.currentTarget.id);null!==o&&o.text(e)}},s.show=function(t){s.normalize(t.currentTarget);var e=s.collection.findById(t.currentTarget.id);return null===e?(e=new s({event:t,delay:i.options.delay,effect:i.options.effect}),s.collection.append(t.currentTarget.id,e)):e.cancelDelayedDestruction(),e},s.prototype={options:{},boundingBox:null,contentBox:null,currentTarget:null,_parentDelayed:!1,timer:null,init:function(){this.currentTarget=this.options.event.currentTarget},renderUI:function(){t("body").append('<div id="thesaurus-'+this.currentTarget.id+'" class="thesaurus hidden">\x3c!-- --\x3e</div>'),this.boundingBox=t("#thesaurus-"+this.currentTarget.id),this.adjust(),this.boundingBox.append(TOOLTIP_BODY_TPL),this.boundingBox.find("a.term").html(t(this.currentTarget).text()),this.contentBox=this.boundingBox.find("div.thesaurus-body"),this.contentBox.html(TOOLTIP_LOADING_TPL),t.fn.bgiframe&&this.boundingBox.bgiframe(),this.boundingBox.css("z-index",zetind),this.options.effect?this.applyEffect(this.options.effect):this.boundingBox.removeClass("hidden")},applyEffect:function(t){switch(t){case"fade":this.boundingBox.fadeIn("slow");break;case"slide":this.boundingBox.slideDown("slow")}},bindUI:function(){this.boundingBox.unbind("mouseover").bind("mouseover",t.proxy(this.cancelDelayedDestruction,this)),this.boundingBox.unbind("mouseleave").bind("mouseleave",t.proxy(this.delayedDestruction,this))},applyOnParent:function(e){var o=t(this.currentTarget).attr("rel");if(o){var n=s.collection.findById(o);if(null!==n)switch(e){case"cancelDelayedDestruction":n._parentDelayed=!0,n.cancelDelayedDestruction();break;case"delayedDestruction":n._parentDelayed&&(n.delayedDestruction(),n._parentDelayed=!1)}}},text:function(t){this.contentBox.html(t)},cancelDelayedDestruction:function(){this.applyOnParent("cancelDelayedDestruction"),this.timer&&(window.clearTimeout(this.timer),this.timer=null)},delayedDestruction:function(){this.applyOnParent("delayedDestruction"),this.timer=window.setTimeout(t.proxy(this.destroy,this),this.options.delay)},destroy:function(){this.boundingBox.remove(),s.remove(this.currentTarget.id)},adjust:function(){var e,o,n=this.options.event,s=t(window).width()-n.clientX,i=t(window).height()-n.clientY;document.documentElement&&document.documentElement.scrollTop?scrollTop=document.documentElement.scrollTop:scrollTop=document.body.scrollTop,document.documentElement&&document.documentElement.scrollLeft?scrollLeft=document.documentElement.scrollLeft:scrollLeft=document.body.scrollLeft,e=s<this.boundingBox.offsetWidth?scrollLeft+n.clientX-this.boundingBox.offsetWidth:scrollLeft+n.clientX,o=i<this.boundingBox.offsetHeight?scrollTop+n.clientY-this.boundingBox.offsetHeight:scrollTop+n.clientY,this.boundingBox.css("top",o+"px"),this.boundingBox.css("left",e+"px")}};var i=function(e){if(null!==i.instance)return t.extend(i.instance.options,e),i.instance;t.extend(this.options,e),i.instance=this,this.init()};i.instance=null,i.prototype={terms:[],options:{},cache:{},init:function(){this.cssLoad(this.options.css),this.options.containers.length||(this.options.containers=["body"]),this.bootstrap()},bindUI:function(e){t(e).find("dfn.thesaurus").each(t.proxy(function(e,o){t(o).bind("mouseenter",t.proxy(this._onMouseOver,this)),t(o).bind("mouseleave",t.proxy(this._onMouseOut,this))},this))},_processOverlayTooltip:function(e,o){t(o).text();if(e){e.off("click").on("click",this,function(t){}),this._searchTermsInDOM(e),this._innerMarkup(e,t(o).attr("id")),this.bindUI(e),t(e).find(".defholder").sweetPages({perPage:this.options.show_count});var n=t(e).find(".swControls").detach();t(e).find("span.controls").append(n)}},_onMouseOver:function(e){var o=s.show(e),n=t(e.currentTarget).text();void 0!==this.cache[n]?(s.text(e,this.cache[n]),this._processOverlayTooltip(o.contentBox,e.currentTarget)):t.getJSON(this.options.JSON_DEF_URI+n+"&filter="+filter.join()+"&callback=?",t.proxy(function(t){this.cache[n]=this._processResponseDef(t),s.text(e,this.cache[n]),this._processOverlayTooltip(o.contentBox,e.currentTarget)},this))},_onMouseOut:function(t){s.hide(t)},cssLoad:function(t){},_processResponseTerm:function(t){var e=null;return void 0===t||void 0===t.status?e=this.options.MESSAGE1:"ok"!=t.status&&(e=t.errorMsg),null!==e?null:t.tags},_processResponseDef:function(t){var e,o=null;if(void 0===t||void 0===t.status?o=this.options.MESSAGE1:"ok"!=t.status&&(o=t.errorMsg),null!==o)return null;if(1==t.count){for(e="<h4>"+t.posts[0].title+"</h4><p>"+t.posts[0].excerpt+"</p>",e+='<div class="legend">'+this.options.MESSAGE2+' <h6><a href="'+t.posts[0].blog_url+'" target="_blank">'+t.posts[0].blog_name+"</a></h6> "+this.options.MESSAGE3+" <h6>",n=0;n<t.posts[0].categories_count;n++)n>0&&(e+=", "),e+='<a href="'+t.posts[0].blog_url+"/category/"+t.posts[0].categories[n].slug+'" target="_blank">'+t.posts[0].categories[n].title+"</a>";e+="</h6></div>",1==t.posts[0].comment_count&&(e+='<div class="thesaurus-footer">'+t.posts[0].comment_count+" "+this.options.MESSAGE6),t.posts[0].comment_count>1&&(e+='<div class="thesaurus-footer">'+t.posts[0].comment_count+" "+this.options.MESSAGE7),0==t.posts[0].comment_count&&(e+='<div class="thesaurus-footer">'+this.options.MESSAGE4),"open"==t.posts[0].comment_status?e+='<a href="'+t.posts[0].url+'#comments" target="_blank">'+this.options.MESSAGE5+"</a></div>":e+="</div>"}else if(t.count>1){var n;for(e="<h4>"+t.count+" "+this.options.MESSAGE10+'</h4> <span class="controls"></span><br /><br />',e+='<ol class="defholder">',n=0;n<t.count;n++){for(e+="<li><h5>"+t.posts[n].title+"</h5><p>"+t.posts[n].excerpt+"</p>",e+='<div class="legend">'+this.options.MESSAGE2+' <h6><a href="'+t.posts[n].blog_url+'" target="_blank">'+t.posts[n].blog_name+"</a></h6> "+this.options.MESSAGE3+" <h6>",r=0;r<t.posts[n].categories_count;r++)r>0&&(e+=", "),e+='<a href="'+t.posts[n].blog_url+"/category/"+t.posts[n].categories[r].slug+'" target="_blank">'+t.posts[n].categories[r].title+"</a>";e+="</h6></div>",1==t.posts[n].comment_count&&(e+='<div class="thesaurus-footer">'+t.posts[n].comment_count+" "+this.options.MESSAGE6),t.posts[n].comment_count>1&&(e+='<div class="thesaurus-footer">'+t.posts[n].comment_count+" "+this.options.MESSAGE7),0==t.posts[n].comment_count&&(e+='<div class="thesaurus-footer">'+this.options.MESSAGE4),"open"==t.posts[n].comment_status?e+='<a href="'+t.posts[n].url+'#comments" target="_blank">'+this.options.MESSAGE5+"</a></div>":e+="</div></li>"}e+="</ol>"}else e="<h4>"+this.options.MESSAGE8+"</h4><p>"+this.options.MESSAGE9+"</p>";return e},bootstrap:function(){var e=t(i.options.containers.join(",")).text().replace(/[\d!;:<>.=\-_`~@*?,%"'\\(\\)\\{\\}]/g," ").replace(/\s+/g," ");t.post(this.options.JSON_LOCAL_POST_URI+"?url="+this.options.JSON_REMOTE_POST_URI+"&mode=native&callback=?",{data:e},t.proxy(function(e){this.terms=this._processResponseTerm(e),null!=this.terms&&(t.each(this.options.containers,t.proxy(function(t,e){this._searchTermsInDOM(e),this._markup(e)},this)),this.bindUI("body"))},this),"json")},_markup:function(e){var o=new RegExp("~~(.*?)~~","g");t.each(t(e),t.proxy(function(e,n){t(n).html(t(n).html().replace(o,'<dfn class="thesaurus">$1</dfn>'))},this))},_innerMarkup:function(e,o){var n=new RegExp("~~(.*?)~~","g");t(e).html(t(e).html().replace(n,'<dfn rel="'+o+'" class="thesaurus">$1</dfn>'))},_markTerm:function(t,o){var n="on"==this.options.caseSensitive?"g":"gi",s="";return s=new RegExp("^("+t+")$",n),o=o.replace(s,"~~$1~~"),s=new RegExp("^("+t+")("+e+")",n),o=o.replace(s,"~~$1~~$2"),s=new RegExp("("+e+")("+t+")$",n),o=o.replace(s,"$1~~$2~~"),s=new RegExp("("+e+")("+t+")("+e+")",n),o=o.replace(s,"$1~~$2~~$3")},_checkNodeValue:function(e){t.each(this.terms,t.proxy(function(t,o){o.length<=e.nodeValue.length&&(e.nodeValue=this._markTerm(o.toString(),e.nodeValue.toString()))},this))},_searchTermsInDOM:function(e){t.each(t(e).get(),t.proxy(function(e,n){t.each(n.childNodes,t.proxy(function(e,n){n.childNodes.length&&-1==t.inArray(n.tagName,o)&&this._searchTermsInDOM(n),void 0===n.tagName&&n.nodeValue.length&&this._checkNodeValue(n)},this))},this))}},i.options={caseSentitive:!1,delay:250,containers:[],effect:null,JSON_TERMS_URI:"https://wikitip.info/api/controller/get_network_thesaurus/?callback=?",JSON_DEF_URI:"https://wikitip.info/api/controller/get_network_posts_by_tag/?tag=",JSON_STATS_URI:"https://wikitip.info/api/controller/update_stats_tag/?tag=",JSON_REMOTE_POST_URI:"https://wikitip.info/api/controller/post_data/?nonce=",JSON_LOCAL_POST_URI:"/ba-simple-proxy.php/",zetind:"auto",MESSAGE1:"Corrupted response format. Contact the webmaster.",MESSAGE2:"Filed in",MESSAGE3:"under",MESSAGE4:"No comments yet",MESSAGE5:"Add comment",MESSAGE6:"comment",MESSAGE7:"comments",MESSAGE8:"Error",MESSAGE9:"There is no definition for this term. Please contact the website admin.",MESSAGE10:"wikis found",MESSAGE11:"A WikiTip Thesaurus",MESSAGE12:"displayed",show_count:-1},t.fn.applyThesaurus=function(){i.options.containers.push(this)},t.Thesaurus=function(e){t.extend(i.options,e)},t(document).ready(function(){t(i.options.containers).length>0&&ACTIVE&&(thes=new i(i.options))})}(jQuery);